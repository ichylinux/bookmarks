<div class="gadgets">
  <% if @bookmarks.present? %>
    <div class="gadget">
      <div>
        <div class="title">Bookmark</div>
        <ol>
          <% @bookmarks.each do |b| %>
            <li><%= link_to b.title, b.url %></li>
          <% end %>
        </ol>
      </div>
    </div>
  <% end %>

  <% if @todos.present? %>
    <div class="gadget todo">
      <div>
        <div class="title">Todo</div>
        <ol>
          <% @todos.each do |t| %>
            <li>
              <span class="<%= "priority_#{t.priority}" %>"><%= t.priority_name %></span>
              <span><%= t.title %></span>
            </li>
          <% end %>
        </ol>
      </div>
    </div>
  <% end %>

  <% @feeds.each do |f| %>
    <script>
      $(document).ready(function() {
        $.get('<%= feed_path(f) %>', {format: 'html'}, function(html) {
          $('#feed_<%= f.id %>').find('ol').replaceWith(html);
        });
      });
    </script>

    <div id="feed_<%= f.id %>" class="gadget">
      <div>
        <div class="title"><%= f.title %></div>
        <ol>
          <li>
            <span style="line-height: <%= f.display_count %>em;">フィードを取得中・・・</span>
          </li>
        </ol>
      </div>
    </div>
  <% end %>
</div>

<div style="clear: both;">
  <script>
    $(document).ready(function() {
      $('.gadget').draggable({
        connectToSortable: '.viewport',
        containment: 'parent'
      });
      
      $('.viewport').sortable({});
    });
  </script>

  <div class="viewport">a</div>
  <div class="viewport">
    <% if @todos.present? %>
      <div class="gadget todo">
        <div>
          <div class="title">Todo</div>
          <ol>
            <% @todos.each do |t| %>
              <li>
                <span class="<%= "priority_#{t.priority}" %>"><%= t.priority_name %></span>
                <span><%= t.title %></span>
              </li>
            <% end %>
          </ol>
        </div>
      </div>
    <% end %>
  </div>
  <div class="viewport">c</div>
</div>
